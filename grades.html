<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SPARK-X | UEAB All Grades & Portal</title>
  <style>
    html,body { background:#000; color:#0f0; font-family:monospace; margin:0;padding:0; width:100vw; min-height:100vh;}
    #cmatrix-canvas { position:fixed; z-index:1; top:0; left:0; width:100vw; height:100vh; pointer-events:none; opacity:0.17; display:block; background:transparent;}
    .portal-content { position:relative; z-index:2; padding:20px; max-width:900px; margin:auto;}
    h1, h2, h3 { text-shadow:0 0 14px #0f0;}
    .brand { font-size:1.2em; font-weight:bold; margin-bottom:16px; letter-spacing:1px;}
    .created-by { font-size:0.95em; color:#0ff; background:#101020; display:inline-block; margin:0 0 15px 0; padding:5px 10px; border-radius:7px; border:1px solid #0ff; box-shadow: 0 0 8px #0ff99c66;}
    .profile { display:flex; align-items:center; gap:25px; margin-bottom:18px;}
    .photo { width:96px; height:96px; background:#111; color:#0f0; display:flex; align-items:center; justify-content:center; font-size:1em; border:2px solid #0f0; border-radius:8px; box-shadow:0 0 8px #0f0 inset;}
    .student-info { line-height:1.7;}
    .summary { background:#101710; border:1px solid #0f05; padding:10px 18px; margin-bottom:24px; border-radius:8px;}
    table { border-collapse:collapse; width:100%; margin-top:16px; font-size:1.03em; background-color:#0a0a0a; box-shadow:0 0 12px #0f02;}
    th,td { border:1px solid #0f0; padding:10px 8px; text-align:left;}
    th { background:#151; color:#aff; font-weight:bold; text-shadow:0 0 7px #0f0a;}
    tr:nth-child(even) { background:#080808;}
    tr:nth-child(odd) { background:#040807;}
    .status-completed { color:#4dfc67; font-weight:bold;}
    .status-inprogress { color:#fffd63;}
    .footer { text-align:right; color:#0ff; opacity:.7; margin-top:40px; font-size:.97em;}
    .section {margin-top:32px; margin-bottom:12px;}
    .assignments, .tt-table {width:100%; border-spacing:0; font-size:1em;}
    .assignments th, .tt-table th {background:#212; color:#aef;}
    .assignments td, .tt-table td {border:1px solid #022; padding:6px;}
    .no-data {color:#f55;}
    .logout-btn { background:#0f0; color:#010; border:none; border-radius:6px; padding:7px 15px; font-size:.96em; font-weight:bold; float:right; margin-top:-8px; cursor:pointer;}
    .logout-btn:hover { background:#20ba20;}
    @media (max-width:750px) {.profile{flex-direction:column; align-items:flex-start;} .student-info{font-size:.97em;} th,td{font-size:.95em;}}
  </style>
</head>
<body>
<canvas id="cmatrix-canvas"></canvas>
<div class="portal-content" id="main-content" style="display:none;">
  <div class="brand" id="brand">SPARK-X | UEAB Portal</div>
  <div class="created-by">Created by Eliakim</div>
  <button class="logout-btn" onclick="logout()">Logout</button>
  <div class="profile">
    <div class="photo" id="photo">No Photo</div>
    <div class="student-info" id="studentInfo"></div>
  </div>
  <div class="summary" id="summary"></div>
  <div class="section">
    <h3>Assignments Approaching</h3>
    <table class="assignments" id="assignmentsTable">
      <thead>
        <tr><th>Course</th><th>Title</th><th>Due</th><th>Description</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="section">
    <h3>Timetable</h3>
    <table class="tt-table" id="ttTable">
      <thead>
        <tr><th>Course</th><th>Time</th><th>Location</th><th>Type</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="ttExtra"></div>
  </div>
  <div class="section">
    <h3>Grades</h3>
    <table id="gradesTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Course Name</th>
          <th>Code</th>
          <th>Group</th>
          <th>Grade</th>
          <th>Credits</th>
          <th>Semester</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="footer">SPARK-X Portal &copy; 2025 | University of Eastern Africa, Baraton</div>
</div>
<script src="students.js"></script>
<script>
// Matrix rain effect
(function matrixEffect() {
  const canvas = document.getElementById("cmatrix-canvas");
  let ctx = canvas.getContext("2d");
  const matrixChars =
    "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz" +
    "的一是在不了有和人这中大为上个国我以要他时来用们生到作地于出就分对成会可主发年动同工也能下过子说产种面而方后多定行学法所民得经十三之进等部度家电力里如水化高自三小" +
    "阿贝塞德鹅西艾弗杰加埃勒艾马艾娜哦佩苦艾儿艾丝特维伊泽" +
    "日月山川天地风雨雷电星辰宇宙海洋和平梦想未来光明希望勇气真理自由荣耀爱心";
  const charsArray = matrixChars.split('');
  let fontSize = 18;
  let columns, drops;
  function resizeMatrix() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    columns = Math.floor(canvas.width / fontSize);
    drops = [];
    for (let x = 0; x < columns; x++)
      drops[x] = Math.random() * canvas.height / fontSize;
  }
  window.addEventListener('resize', resizeMatrix);
  resizeMatrix();
  function drawMatrix() {
    ctx.fillStyle = "rgba(0, 0, 0, 0.17)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.font = fontSize + "px monospace";
    for (let i = 0; i < columns; i++) {
      let text = charsArray[Math.floor(Math.random() * charsArray.length)];
      ctx.fillStyle = i % 7 === 0 ? "#0ff" : "#0f0";
      ctx.fillText(text, i * fontSize, drops[i] * fontSize);
      if (drops[i] * fontSize > canvas.height && Math.random() > 0.975)
        drops[i] = 0;
      else
        drops[i] += 1 + Math.random() * 0.8;
    }
    requestAnimationFrame(drawMatrix);
  }
  drawMatrix();
})();
// Utilities
function logout() {
  localStorage.removeItem('currentStudent');
  window.location.href = "login.html";
}
function escapeHTML(txt) {
  return txt.replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[m]));
}
window.onload = function() {
  const user = localStorage.getItem('currentStudent');
  const student = studentsDB[user];
  if (!student) { window.location.href = 'login.html'; return; }
  document.getElementById('main-content').style.display = '';
  document.getElementById('studentInfo').innerHTML =
    `<strong>Name:</strong> ${escapeHTML(student.name)}<br>
    <strong>Student ID:</strong> ${escapeHTML(user)}<br>
    <strong>Programme:</strong> ${escapeHTML(student.programme)}<br>
    <strong>Academic Year:</strong> ${escapeHTML(student.year)}<br>
    <strong>Status:</strong> ${escapeHTML(student.status)}`;
  // Grades
  const grades = student.grades || [];
  let completed = 0, inprogress = 0;
  const gradesTable = document.getElementById('gradesTable').querySelector('tbody');
  gradesTable.innerHTML = "";
  grades.forEach((row,i) => {
    let st = row.status === 'Completed' ? ++completed && 'status-completed' : ++inprogress && 'status-inprogress';
    gradesTable.innerHTML += `<tr>
      <td>${i + 1}</td>
      <td>${escapeHTML(row.name)}</td>
      <td>${escapeHTML(row.code)}</td>
      <td>${escapeHTML(row.group)}</td>
      <td>${escapeHTML(row.grade)}</td>
      <td>${escapeHTML(row.credits+"")}</td>
      <td>${escapeHTML(row.semester)}</td>
      <td class="${st}">${escapeHTML(row.status)}</td>
    </tr>`;
  });
  document.getElementById('summary').innerHTML =
    `<b>Academic Summary:</b><br>
    Total Registered Courses: ${grades.length}<br>
    Completed Courses: ${completed}<br>
    In Progress: ${inprogress}`;
  // Assignments Approaching
  const assignments = (student.assignments || []).slice().sort((a,b)=>a.due.localeCompare(b.due));
  let now = new Date();
  let asgBody = document.getElementById('assignmentsTable').querySelector('tbody');
  asgBody.innerHTML = "";
  let hasAsg = false;
  assignments.forEach(a=>{
    let due = new Date(a.due);
    if ((due-now)/36e5 >= -48) {
      hasAsg = true;
      asgBody.innerHTML += `<tr>
        <td>${escapeHTML(a.course)}</td>
        <td>${escapeHTML(a.title)}</td>
        <td>${escapeHTML(new Date(a.due).toLocaleString())}</td>
        <td>${escapeHTML(a.desc)}</td>
      </tr>`;
    }
  });
  if (!hasAsg) asgBody.innerHTML = `<tr><td colspan="4" class="no-data">No assignments approaching</td></tr>`;
  // Timetable
  const timetable = student.timetable || [];
  let nowstr = (new Date()).toISOString().slice(0,16);
  let classesToday = timetable.filter(c => c.start.slice(0,10) === nowstr.slice(0,10));
  let {recent, next} = findClasses(timetable, new Date());
  let ttBody = document.getElementById('ttTable').querySelector('tbody');
  ttBody.innerHTML = "";
  if (classesToday.length) {
    classesToday.forEach(c=>{
      const type = (recent && c.course===recent.course && c.start===recent.start) ? "Most Recent" :
                    (next && c.course===next.course && c.start===next.start) ? "Next" : "";
      ttBody.innerHTML += `<tr>
        <td>${escapeHTML(c.course)}</td>
        <td>${escapeHTML(new Date(c.start).toLocaleTimeString())} - ${escapeHTML(new Date(c.end).toLocaleTimeString())}</td>
        <td>${escapeHTML(c.location)}</td>
        <td>${type}</td>
      </tr>`;
    });
  } else {
    ttBody.innerHTML = `<tr><td colspan="4" class="no-data">No classes scheduled today</td></tr>`;
  }
  let ttExtra = "";
  if (recent) ttExtra += `<b>Most Recent Class:</b> ${escapeHTML(recent.course)} (${escapeHTML(new Date(recent.end).toLocaleTimeString())} ended)<br>`;
  if (next) ttExtra += `<b>Next Class:</b> ${escapeHTML(next.course)} at ${escapeHTML(new Date(next.start).toLocaleTimeString())}`;
  document.getElementById('ttExtra').innerHTML = ttExtra;
}
</script>
</body>
</html>
